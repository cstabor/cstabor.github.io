<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
	<title>Linux Process Tool</title>
	<meta name="description" content="毛小可嗒嗒的个人博客、web、前端、javascript、css、html、H5、CSS3、web前端工程师、gulp、jekyll、git">
	<meta name="keywords" content="web、前端、webapp、个人博客、技术博客、github博客、javascript、css、html、H5、CSS3、web前端工程师、gulp" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="msapplication-tap-highlight" content="no">
	<meta name="author" contect="maoxiaoke, maoxiaoke@outlook.com">
	<meta name="robots" content="index,follow">
	<link rel="shortcut icon" href="/styles/images/favicon.png">
	<link rel="icon" href="/styles/images/favicon.png">
	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="canonical" href="http://0.0.0.0:4000">
	<!--[if lte IE 9]>
    	<script src="http://apps.bdimg.com/libs/html5shiv/3.7/html5shiv.min.js"></script>
  	<![endif]-->
	<!--[if lt IE 9]>
    	<script>window.location.href='/upgrade-your-browser.html';</script>
    <![endif]-->
	<script>
		var _hmt = _hmt || [];
		(function() {
  			var hm = document.createElement("script");
  			hm.src = "https://hm.baidu.com/hm.js?40ab350f7c60a488b8e8093960c0faf2";
  			var s = document.getElementsByTagName("script")[0]; 
  			s.parentNode.insertBefore(hm, s);
		})();
	</script>
</head>
  <body class="index">
    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.png" alt="小可嗒嗒的个人博客">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li></li>
        <li>
          <a href="/">首页</a>
        </li>
        <li>
          <a href="/categories/">博文分类</a>
        </li>
        <li>
          <a href="/tag">标签目录</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a rel="nofollow" href="/reference">外域链接</a></li>
        <li><a href="/effects">DEMO</a></li>
        <li><a href="/donate">打赏我</a></li>
        <li><a rel="nofollow" href="/me">关于我</a></li> 
        <li><a rel="nofollow" href="/talktome">TalkToMe</a></li>
             
        <!--
        <li><a rel="nofollow" target="_blank" href="http://cstabor.github.io/me/">关于我</a></li> 
        -->
      </ul>
    </nav>
  </div>
</header>
    <div class="docs-header pa" id="content">
    <canvas id="mycanvas">你的浏览器不支持canvas</canvas>
    <div class="container" >
  	
        <!--
		    <h1>Linux Process Tool</h1>
		    <p>Post on Nov 08, 2017 by <a href="/about">helloworld</a></p>
		-->
        <h1></h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container lh30">
  	
    	<a href="/categories/#linux-ref">linux</a>	/
    	<a href="/tag/#linux shell-ref">linux shell</a>
    
      <div id="search-container" class="pull-right">
          <input type="text" id="search-input" placeholder=" 试试直接搜索吧...">
          <label class="searchIcon glyphicon glyphicon-search" for="search-input"></label>
          <ul id="results-container"></ul>
      </div>
  </div>
</div>

    
    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2017">2017</a>
          <ul class="nav">
            <li><a href="#month_2017_November">November</a></li>
      

      
        
            </ul>
          </li>
          <li><a href="#year_2016">2016</a>
            <ul class="nav">
              <li><a href="#month_2016_July">July</a></li>
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_June">June</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_May">May</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
        
            </ul>
          </li>
          <li><a href="#year_2015">2015</a>
            <ul class="nav">
              <li><a href="#month_2015_August">August</a></li>
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div> 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">Linux Process Tool</h1>
              <!--
                <p class="post-meta">Nov 8, 2017</p>
              -->
              <div class="meta">Date： <span class="postdate">Nov 08, 2017</span> Author： <a target="_blank" href="http://0.0.0.0:4000">helloworld</a></div>
              <br />
              <blockquote><p>本文章采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh"> 知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议 </a>进行许可。转载请注明来自<a href="http://cstabor.github.io">cstabor</a></p></blockquote>
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#进程" id="markdown-toc-进程">进程</a>    <ul>
      <li><a href="#1-strace" id="markdown-toc-1-strace">1. strace</a>        <ul>
          <li><a href="#11-诊断进程id" id="markdown-toc-11-诊断进程id">1.1 诊断进程ID</a></li>
          <li><a href="#12-诊断程序" id="markdown-toc-12-诊断程序">1.2 诊断程序</a></li>
          <li><a href="#12-统计汇总进程的调用" id="markdown-toc-12-统计汇总进程的调用">1.2 统计汇总进程的调用</a></li>
          <li><a href="#13-按进程名查看" id="markdown-toc-13-按进程名查看">1.3 按进程名查看</a></li>
          <li><a href="#14-查看进程的线程" id="markdown-toc-14-查看进程的线程">1.4 查看进程的线程</a></li>
          <li><a href="#15-时间统计" id="markdown-toc-15-时间统计">1.5 时间统计</a></li>
          <li><a href="#16-输出到标准输出" id="markdown-toc-16-输出到标准输出">1.6 输出到标准输出</a></li>
          <li><a href="#17-输出到指定文件" id="markdown-toc-17-输出到指定文件">1.7 输出到指定文件</a></li>
          <li><a href="#18-跟踪指定调用的耗时" id="markdown-toc-18-跟踪指定调用的耗时">1.8 跟踪指定调用的耗时</a></li>
          <li><a href="#19-内核态和用户态" id="markdown-toc-19-内核态和用户态">1.9 内核态和用户态</a></li>
        </ul>
      </li>
      <li><a href="#2-ltrace" id="markdown-toc-2-ltrace">2. ltrace</a></li>
      <li><a href="#3-进程查看" id="markdown-toc-3-进程查看">3. 进程查看</a>        <ul>
          <li><a href="#31-pidof按进程名查进程号" id="markdown-toc-31-pidof按进程名查进程号">3.1 (pidof)按进程名查进程号</a></li>
          <li><a href="#32-pgrep-过滤最新进程id" id="markdown-toc-32-pgrep-过滤最新进程id">3.2 (pgrep) 过滤最新进程ID</a></li>
          <li><a href="#33-pwdx-查看进程的路径" id="markdown-toc-33-pwdx-查看进程的路径">3.3 (pwdx) 查看进程的路径</a></li>
          <li><a href="#34-top-查看系统负载" id="markdown-toc-34-top-查看系统负载">3.4 (top) 查看系统负载</a>            <ul>
              <li><a href="#341-间隔时间查看系统负载" id="markdown-toc-341-间隔时间查看系统负载">3.4.1 间隔时间查看系统负载</a></li>
              <li><a href="#342-查看cpu列表" id="markdown-toc-342-查看cpu列表">3.4.2 查看CPU列表</a></li>
              <li><a href="#343-按cpu排序" id="markdown-toc-343-按cpu排序">3.4.3 按CPU排序</a></li>
              <li><a href="#344-查看指定进程id的负载" id="markdown-toc-344-查看指定进程id的负载">3.4.4 查看指定进程ID的负载</a></li>
              <li><a href="#345-查看用户进程负载" id="markdown-toc-345-查看用户进程负载">3.4.5 查看用户进程负载</a></li>
            </ul>
          </li>
          <li><a href="#35-ps-查询" id="markdown-toc-35-ps-查询">3.5 (ps) 查询</a>            <ul>
              <li><a href="#351-按名称查询" id="markdown-toc-351-按名称查询">3.5.1 按名称查询</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#4-子进程" id="markdown-toc-4-子进程">4. 子进程</a>        <ul>
          <li><a href="#41-ps子进程列表" id="markdown-toc-41-ps子进程列表">4.1 (ps)子进程列表</a></li>
          <li><a href="#42-pstree子进程列表" id="markdown-toc-42-pstree子进程列表">4.2 (pstree)子进程列表</a>            <ul>
              <li><a href="#421-查看指定用户的进程树" id="markdown-toc-421-查看指定用户的进程树">4.2.1 查看指定用户的进程树</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#线程" id="markdown-toc-线程">线程</a>    <ul>
      <li><a href="#11-ps查看" id="markdown-toc-11-ps查看">1.1 (ps)查看</a></li>
      <li><a href="#12-top查看" id="markdown-toc-12-top查看">1.2 (top)查看</a></li>
    </ul>
  </li>
  <li><a href="#协程" id="markdown-toc-协程">协程</a></li>
</ul>

<h1 id="进程">进程</h1>

<h2 id="1-strace">1. strace</h2>

<p>strace - trace system calls and signals</p>

<blockquote>
  <p>Refer</p>
</blockquote>

<ol>
  <li>https://blog.packagecloud.io/eng/2015/11/15/strace-cheat-sheet/</li>
</ol>

<h3 id="11-诊断进程id">1.1 诊断进程ID</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// strace a running process
strace -p [pid]

// strace a running process and threads
strace -fp [pid]

// strace a running process and print strings
strace -s 80 -fp [pid]
</code></pre></div></div>

<p>示例：</p>

<p>注意需要root权限</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># strace -p 2061
strace: Process 2061 attached
semop(393224, [{0, -1, SEM_UNDO}], 1
</code></pre></div></div>

<h3 id="12-诊断程序">1.2 诊断程序</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// strace a program
strace ./program

// strace a program and threads
strace -f ./program

// strace a program and print strings
strace -s 80 -f ./program
</code></pre></div></div>

<h3 id="12-统计汇总进程的调用">1.2 统计汇总进程的调用</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strace -c -p pid

strace -c process_name
</code></pre></div></div>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># strace -c -p 1191
strace: Process 1191 attached

^Cstrace: Process 1191 detached
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 30.82    0.000777          22        35           open
 28.32    0.000714          20        35           read
 23.24    0.000586          17        35           epoll_wait
 17.61    0.000444          13        35           close
------ ----------- ----------- --------- --------- ----------------
100.00    0.002521                   140           total
</code></pre></div></div>

<h3 id="13-按进程名查看">1.3 按进程名查看</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strace ls

strace ./hello
</code></pre></div></div>

<h3 id="14-查看进程的线程">1.4 查看进程的线程</h3>

<p>-f          Trace  child  processes  as  they  are  created  by currently traced processes as a result of the fork(2), vfork(2) and clone(2) system calls.  Note that -p PID -f will attach all threads of process PID if it is  multi-threaded,  not  only thread with thread_id = PID.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strace -f -p pid

strace -f proccess_name
</code></pre></div></div>

<h3 id="15-时间统计">1.5 时间统计</h3>

<p>-r 表示相对时间</p>

<p>-T 表示绝对时间</p>

<p>简单统计可以用<code class="highlighter-rouge">-r</code>，但是需要注意的是在多任务背景下，CPU随时可能会被切换出去做别的事情，所以相对时间不一定准确，此时最好使用<code class="highlighter-rouge">-T</code>，在行尾可以看到操作时间，可以发现确实很慢。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ strace -r ./hello
     0.000000 execve("./hello", ["./hello"], [/* 66 vars */]) = 0
     0.000417 brk(NULL)                 = 0x1765000
     0.000102 mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f7af22cd000
     0.000095 access("/etc/ld.so.preload", R_OK) = -1 ENOENT (No such file or directory)
     0.000079 open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
     0.000068 fstat(3, {st_mode=S_IFREG|0644, st_size=135921, ...}) = 0
     0.000070 mmap(NULL, 135921, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f7af22ab000
     0.000054 close(3)                  = 0

</code></pre></div></div>

<h3 id="16-输出到标准输出">1.6 输出到标准输出</h3>

<p>注意: strace的结果在标准错误里，使用前最好重定向到标准输出。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ strace -T ./hello 2&gt;&amp;1 | grep -B 5 brk
execve("./hello", ["./hello"], [/* 66 vars */]) = 0 &lt;0.000150&gt;
brk(NULL)                               = 0xf35000 &lt;0.000031&gt;
</code></pre></div></div>

<h3 id="17-输出到指定文件">1.7 输出到指定文件</h3>

<p>-o filename Write  the trace output to the file filename rather than to stderr.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ strace -o /tmp/strace.out -T ./hello
</code></pre></div></div>

<h3 id="18-跟踪指定调用的耗时">1.8 跟踪指定调用的耗时</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       -e expr     A qualifying expression which modifies which events to trace or how to trace them.   The
                   format of the expression is:

                             [qualifier=][!]value1[,value2]...

                   where  qualifier is one of trace, abbrev, verbose, raw, signal, read, or write and value
                   is a qualifier-dependent symbol or number.  The default qualifier is  trace.   Using  an
                   exclamation  mark  negates  the  set  of  values.   For example, -e open means literally
                   -e trace=open which in turn means  trace  only  the  open  system  call.   By  contrast,
                   -e trace=!open  means  to trace every system call except open.  In addition, the special
                   values all and none have the obvious meanings.

</code></pre></div></div>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ strace -e open -T ./hello
open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3 &lt;0.000015&gt;
open("/lib64/libc.so.6", O_RDONLY|O_CLOEXEC) = 3 &lt;0.000015&gt;
file num: 256
+++ exited with 0 +++

</code></pre></div></div>

<h3 id="19-内核态和用户态">1.9 内核态和用户态</h3>

<p>如果用 strace 跟踪一个进程，输出结果很少，可以试试 ltrace，可能会发现别有洞天。记住有内核态和用户态之分。</p>

<h2 id="2-ltrace">2. ltrace</h2>

<p>ltrace - A library call tracer</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strace
https://rainbow.chard.org/2011/10/02/debug-like-a-sysadmin/


ptrace - process trace
pidx

mtrace (3)           - malloc tracing
muntrace (3)         - malloc tracing
backtrace (3)        - support for application self-debugging
tcptraceroute (8)    - print the route packets trace to network host

/usr/bin/ltrace
/usr/bin/mtrace
/usr/bin/strace
/usr/bin/blktrace
/usr/bin/btrace
/usr/bin/dtrace
/usr/bin/xtrace

/usr/sbin/autrace

lstat("/home/data/services/yesdatphp/bosslite/api/runtime/logs/app.log", {st_mode=S_IFREG|0644, st_size=4269249, ...}) = 0
lstat("/home/data/services/yesdatphp/bosslite/api/runtime/logs", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0
lstat("/home/data/services/yesdatphp/bosslite/api/runtime", {st_mode=S_IFLNK|0777, st_size=28, ...}) = 0
readlink("/home/data/services/yesdatphp/bosslite/api/runtime", "/data/logs/bosslite_api-1.0/", 4096) = 28
</code></pre></div></div>

<h2 id="3-进程查看">3. 进程查看</h2>

<h3 id="31-pidof按进程名查进程号">3.1 (pidof)按进程名查进程号</h3>

<p>pidof – find the process ID of a running program.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pidof process_name
</code></pre></div></div>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pidof httpd
2061 2060 2059 2058 2057 2056 2055 2054 2047 2046 2045 2044 1899 1898 1846 1711 1710 1709 1708 1707 1706 1705 1704 1703 1702 1615
</code></pre></div></div>

<h3 id="32-pgrep-过滤最新进程id">3.2 (pgrep) 过滤最新进程ID</h3>

<p>pgrep, pkill - look up or signal processes based on name and other attributes</p>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pgrep -n httpd
2061
</code></pre></div></div>

<h3 id="33-pwdx-查看进程的路径">3.3 (pwdx) 查看进程的路径</h3>

<p>report current working directory of a process</p>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pwdx 1191
1191: /usr/local/services/redis-3.2.0/data/6379
</code></pre></div></div>

<h3 id="34-top-查看系统负载">3.4 (top) 查看系统负载</h3>

<h4 id="341-间隔时间查看系统负载">3.4.1 间隔时间查看系统负载</h4>

<p>每间隔一秒输出一次系统负载</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>top -d 1
</code></pre></div></div>

<p>也可以进入 <code class="highlighter-rouge">top</code> 命令后 输入 <code class="highlighter-rouge">d</code>  再输入 <code class="highlighter-rouge">1</code>，实现相同的功能</p>

<h4 id="342-查看cpu列表">3.4.2 查看CPU列表</h4>

<p>进入 <code class="highlighter-rouge">top</code> 后 按 <code class="highlighter-rouge">1</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%Cpu0  :  1.2 us,  0.4 sy,  0.0 ni, 94.9 id,  3.5 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu1  :  0.8 us,  0.0 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu2  :  2.0 us,  0.4 sy,  0.0 ni, 97.6 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu3  :  1.2 us,  0.4 sy,  0.0 ni, 98.4 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu4  :  0.4 us,  0.4 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu5  :  0.8 us,  0.4 sy,  0.0 ni, 98.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu7  :  0.8 us,  0.0 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st

</code></pre></div></div>

<h4 id="343-按cpu排序">3.4.3 按CPU排序</h4>

<p><code class="highlighter-rouge">shift + P</code></p>

<h4 id="344-查看指定进程id的负载">3.4.4 查看指定进程ID的负载</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>top -p pid
</code></pre></div></div>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>top -p 25837,2492
</code></pre></div></div>

<p>注意：分隔符是 逗号</p>

<h4 id="345-查看用户进程负载">3.4.5 查看用户进程负载</h4>

<ol>
  <li>top 进入负载检测页面</li>
  <li>输入 <code class="highlighter-rouge">u</code>  再输入 apache 的运行用户 <code class="highlighter-rouge">nobdoy</code>  ，即展示了 httpd 的负载进程相关参数</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>top - 18:08:27 up 2 days,  8:35,  6 users,  load average: 0.25, 0.28, 0.22
Tasks: 379 total,   2 running, 377 sleeping,   0 stopped,   0 zombie
%Cpu(s):  1.5 us,  0.5 sy,  0.0 ni, 97.8 id,  0.2 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 12009984 total,   393028 free,  7572180 used,  4044776 buff/cache
KiB Swap:  6103036 total,  6103036 free,        0 used.  3228692 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                 
15461 nobody    20   0  381412  36220   5752 S   0.0  0.3   0:09.40 httpd                                                   
15462 nobody    20   0  382224  36864   5824 S   0.0  0.3   0:09.61 httpd                                                   
15463 nobody    20   0  378092  36684   5656 S   0.0  0.3   0:08.26 httpd                                                   
15464 nobody    20   0  380728  35660   5760 S   0.0  0.3   0:08.61 httpd                                                   
15465 nobody    20   0  384556  39368   5752 S   0.0  0.3   0:09.59 httpd                                                   
15466 nobody    20   0  381716  36248   5712 S   0.0  0.3   0:08.37 httpd                                                   
15467 nobody    20   0  379208  34324   5956 S   0.0  0.3   0:07.99 httpd                                                   
15468 nobody    20   0  376740  36072   6032 S   0.0  0.3   0:07.93 httpd                                                   
15469 nobody    20   0  375224  34196   5676 S   0.0  0.3   0:06.31 httpd
</code></pre></div></div>

<h3 id="35-ps-查询">3.5 (ps) 查询</h3>

<h4 id="351-按名称查询">3.5.1 按名称查询</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-C cmdlist
	Select by command name.  This selects the processes whose executable name is given in cmdlist.

h      
	No header.  (or, one header per screen in the BSD personality).  The h option is problematic.  Standard
	BSD ps uses this option to print a header on each page of output, but older Linux ps uses this option to
	totally disable the header.  This version of ps follows the Linux usage of not printing the header unless
  	the BSD personality has been selected, in which case it prints a header on each page of output.
  	Regardless of the current personality, you can use the long options --headers and --no-headers to enable
  	printing headers each page or disable headers entirely, respectively.

-o format
	User-defined format.  format is a single argument in the form of a blank-separated or comma-separated
	list, which offers a way to specify individual output columns. 
	stat, pid, ppid, cmd

</code></pre></div></div>

<p>示例1</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ps -C httpd
  PID TTY          TIME CMD
15454 ?        00:00:03 httpd
15461 ?        00:00:09 httpd
15462 ?        00:00:09 httpd
15463 ?        00:00:08 httpd
15464 ?        00:00:08 httpd
15465 ?        00:00:09 httpd
15466 ?        00:00:08 httpd
15467 ?        00:00:07 httpd
</code></pre></div></div>

<p>示例2</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user_00@node7 yesdatphp]$ ps h -C httpd
15454 ?        Ss     0:03 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15461 ?        S      0:09 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15462 ?        S      0:09 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15463 ?        S      0:08 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15464 ?        S      0:08 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15465 ?        S      0:09 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15466 ?        S      0:08 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15467 ?        S      0:07 /usr/local/services/httpd-2.4.12/bin/httpd -k start
15468 ?        S      0:07 /usr/local/services/httpd-2.4.12/bin/httpd -k start
</code></pre></div></div>

<p>示例3</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user_00@node7 yesdatphp]$ ps h -ostat,pid -C httpd
Ss   15454
S    15461
S    15462
S    15463
S    15464
S    15465
S    15466
S    15467

</code></pre></div></div>

<h2 id="4-子进程">4. 子进程</h2>

<h3 id="41-ps子进程列表">4.1 (ps)子进程列表</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps -ostat,cmd --ppid &lt;ppid&gt;
</code></pre></div></div>

<p>–ppid   指定父进程ID</p>

<p>-o</p>

<p>​	stat    状态</p>

<p>​	pid     进程ID</p>

<p>​	cmd   启动命令</p>

<p>​	args   与 cmd 类似</p>

<p>​	lstart  启动时间</p>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user_00@dev201 6379]$ ps -opid,stat,cmd --ppid 47466
  PID STAT CMD
48683 S    /usr/local/services/httpd-2.4.12/bin/httpd -k start
48684 S    /usr/local/services/httpd-2.4.12/bin/httpd -k start
48685 S    /usr/local/services/httpd-2.4.12/bin/httpd -k start
48686 S    /usr/local/services/httpd-2.4.12/bin/httpd -k start
</code></pre></div></div>

<h3 id="42-pstree子进程列表">4.2 (pstree)子进程列表</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user_00@node7 yesdatphp]$ pstree -p 15454
httpd(15454)─┬─httpd(15461)
             ├─httpd(15462)
             ├─httpd(15463)
             ├─httpd(15464)
             ├─httpd(15465)
             ├─httpd(15466)
             ├─httpd(15467)

</code></pre></div></div>

<h4 id="421-查看指定用户的进程树">4.2.1 查看指定用户的进程树</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pstree &lt;user_name&gt;
</code></pre></div></div>

<p>示例</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user_00@node7 yesdatphp]$ pstree mysql
mysqld_safe───mysqld───18*[{mysqld}]

</code></pre></div></div>

<h1 id="线程">线程</h1>

<p>线程是现代操作系统上进行并行执行的一个流行的编程方面的抽象概念。当一个程序内有多个线程被叉分出用以执行多个流时，这些线程就会在它们之间共享 特定的资源（如，内存地址空间、打开的文件），以使叉分开销最小化，并避免大量高成本的IPC（进程间通信）通道。这些功能让线程在并发执行时成为一个高 效的机制。
在Linux中，程序中创建的线程（也称为轻量级进程，LWP）会具有和程序的PID相同的“线程组ID”。然后，各个线程会获得其自身的线程 ID（TID）。对于Linux内核调度器而言，线程不过是恰好共享特定资源的标准的进程而已。经典的命令行工具，如ps或top，都可以用来显示线程级 别的信息，只是默认情况下它们显示进程级别的信息。</p>

<h2 id="11-ps查看">1.1 (ps)查看</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps -T -p &lt;pid&gt;
</code></pre></div></div>

<p>-T  开启线程查看</p>

<p>示例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user_00@node7 apache-tomcat-8.5.23]$ ps -T -p 8488
  PID  SPID TTY          TIME CMD
 8488  8488 pts/1    00:00:00 java
 8488  8503 pts/1    00:00:00 java
 8488  8508 pts/1    00:00:00 java
 8488  8509 pts/1    00:00:00 java
 8488  8510 pts/1    00:00:00 java
 8488  8511 pts/1    00:00:00 java
 8488  8512 pts/1    00:00:00 java
 8488  8513 pts/1    00:00:00 java
</code></pre></div></div>

<p>SPID  表示线程ID</p>

<p>CMD  表示线程名称</p>

<h2 id="12-top查看">1.2 (top)查看</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>top -H -p &lt;pid&gt;
</code></pre></div></div>

<p>-H   列出所有linux线程</p>

<p>示例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>top - 15:37:41 up 2 days,  6:04,  6 users,  load average: 0.38, 0.17, 0.14
Threads:  51 total,   0 running,  51 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.0 us,  0.5 sy,  0.0 ni, 97.4 id,  0.2 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 12009984 total,   210388 free,  7084520 used,  4715076 buff/cache
KiB Swap:  6103036 total,  6103036 free,        0 used.  3678600 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                       
 8555 user_00   20   0 6948056 145960  11668 S  0.3  1.2   0:00.13 java                                          
 8488 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.00 java                                          
 8503 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.76 java                                          
 8508 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.01 java                                          
 8509 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.01 java                                          
 8510 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.01 java                                          
 8511 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.00 java                                          
 8512 user_00   20   0 6948056 145960  11668 S  0.0  1.2   0:00.01 java 
</code></pre></div></div>

<p>也可以进入 top 之后再按 <code class="highlighter-rouge">H</code> ，显示线程</p>

<h1 id="协程">协程</h1>


            </article>
          <hr>
          <blockquote><p>对于本文内容有问题或建议的小伙伴，欢迎在文章底部留言交流讨论。</p></blockquote>
          <div class="text-center">
            <a href="/donate/" target="_blank" style="text-decoration: none"><button type="button" class="btn btn-danger"><span class="glyphicon glyphicon-usd" aria-hidden="true"></span> 您的支持是将是我写作最大的动力!</button></a>
          </div>
        </div>
      </div>
      <!--comment-->
      <!--code for 网易云跟帖
      <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
            <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
            <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
            <script>
            var cloudTieConfig = {
            url: document.location.href, 
            sourceId: "",
            productKey: "b6d55f09637f497389b80bafc11aada1",
            target: "cloud-tie-wrapper"
            };
            var yunManualLoad = true;
            Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
            </script>
          </div>
        </article>
      </div> -->
      <!--Gitment-->
      <div id="container"></div>
      <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
      <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
      <script>
        var gitment = new Gitment({
          id: window.location.pathname, 
          owner: 'maoxiaoke',
          repo: 'maoxiaoke.github.io',
          oauth: {
          client_id: 'a884d93361c09d5c03b3',
          client_secret: '73f1de789521db427d431e9f8488db2f974ee0ba',
          },
        })
        gitment.render('container')
      </script>
      
    </div>
  </div>
</div>


    <footer class="footer" role="contentinfo">
	<!--不蒜子pv/uv统计-->
	<div class="post-meta">
            <p>Total <span id="busuanzi_value_site_pv"></span> views，您是本站的第<span id="busuanzi_value_site_uv"></span>个小伙伴，<span id="busuanzi_value_page_pv"></span> Hits</p><br/>
    </div>
	<div class="container">
		<p class="copyright">Copyright &copy; 2017 <a href="http://cstabor.github.io/me/" target="_blank"><code>helloworld</code></a>. All rights reserved. </p>
		<p>Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>， Data by <a href="https://tongji.baidu.com/web/23811489/overview/index" target="_blank">Bai Du</a>.</p>
	</div>
	<ul id="gotop"><li><span>TOP</span></li></ul>
</footer>
<script src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="/styles/js/function.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.min.js"></script>
  </body>
</html>
